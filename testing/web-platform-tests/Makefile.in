# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

include $(topsrcdir)/config/rules.mk

ifneq ($(OS_ARCH),WINNT)

WPT_HARNESS = \
  wpttests \
  runtests.py \
  $(NULL)

WPT_TESTS = \
  tests \
  $(NULL)

WPT_METADATA = \
  metadata \
  $(NULL)

_DEST_DIR = $(DEPTH)/_tests/web-platform-tests
libs:: $(WPT_HARNESS)
	$(INSTALL) $(foreach f,$^,"$f") $(_DEST_DIR)
libs:: $(WPT_TESTS)
	$(INSTALL) $(foreach f,$^,"$f") $(_DEST_DIR)
libs:: $(WPT_METADATA)
	$(INSTALL) $(foreach f,$^,"$f") $(_DEST_DIR)

stage-package: PKG_STAGE = $(DIST)/test-package-stage
stage-package:
	$(NSINSTALL) -D $(PKG_STAGE)/web-platform-tests
	@(cd $(srcdir) && tar $(TAR_CREATE_FLAGS) - $(WPT_HARNESS)) | (cd $(PKG_STAGE)/web-platform-tests && tar -xf -)
	@(cd $(srcdir) && tar $(TAR_CREATE_FLAGS) - $(WPT_TESTS)) | (cd $(PKG_STAGE)/web-platform-tests && tar -xf -)
	@(cd $(srcdir) && tar $(TAR_CREATE_FLAGS) - $(WPT_METADATA)) | (cd $(PKG_STAGE)/web-platform-tests && tar -xf -)

endif
